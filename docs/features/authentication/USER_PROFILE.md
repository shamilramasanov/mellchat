# User Profile Page Logic - Страница пользователя

## 🎯 Концепция

**Централизованная страница пользователя** с настройками, профилем и управлением AI-функциями. Доступна только авторизованным пользователям.

## 📐 Структура страницы

### Маршрут
- **URL:** `/profile` или `/settings`
- **Доступ:** Только авторизованным пользователям
- **Навигация:** Иконка профиля в Header → "Профиль" или "Настройки"

## 🗂️ Секции страницы

### 1. Header (шапка профиля)

```
┌─────────────────────────────────────────────┐
│  [← Назад]    Профиль          [Выйти]     │
└─────────────────────────────────────────────┘
```

**Элементы:**
- Кнопка "Назад" (вернуться в чат)
- Заголовок "Профиль" или "Настройки"
- Кнопка "Выйти" (выход из аккаунта)

### 2. Профиль пользователя

```
┌─────────────────────────────────────────────┐
│  [Аватар]                                    │
│                                              │
│  Имя пользователя                            │
│  email@example.com                           │
│  Вход через: Google                          │
│                                              │
│  Участник с: 15 января 2024                  │
└─────────────────────────────────────────────┘
```

**Информация:**
- Аватар (из Google OAuth или дефолтный)
- Имя пользователя (`displayName` или `username`)
- Email
- Способ авторизации (Google, GitHub и т.д.)
- Дата регистрации / первого входа

**Источник данных:**
```javascript
// Из authService
{
  id: "user123",
  email: "user@example.com",
  name: "User Name",
  provider: "google",
  createdAt: "2024-01-15T10:00:00Z"
}
```

### 3. AI Настройки

```
┌─────────────────────────────────────────────┐
│  🤖 AI Фильтр спама                         │
├─────────────────────────────────────────────┤
│  Статус: ✅ Обучен                          │
│  Обучен: 15 января 2024, 10:30              │
│  Найдено спама: 1,250 (12.5%)              │
│                                              │
│  [⚙️ Настроить обучение]                    │
└─────────────────────────────────────────────┘
```

**Блоки:**

#### 3.1. Статус обучения
- **Если не обучен:**
  - "Статус: ⚠️ Не обучен"
  - Кнопка "Обучить фильтр"

- **Если обучен:**
  - "Статус: ✅ Обучен"
  - Дата последнего обучения
  - Статистика (найдено спама, процент)
  - Кнопка "Переобучить фильтр"

#### 3.2. Настройки обучения (при клике на "Настроить")
- Размер выборки: [5k] [10k] [50k]
- Область выборки: [Все] [Активные] [Конкретный стрим]
- Строгость: [Строгий] [Умеренный] [Мягкий]
- Лимиты: "Использовано: 1/3 обучений сегодня"

#### 3.3. Процесс обучения
- Прогресс-бар (0-100%)
- Этапы:
  - "Получение выборки..."
  - "Анализ AI..."
  - "Сохранение правил..."
- Кнопка "Отменить" (если возможно)

### 4. Настройки приложения

```
┌─────────────────────────────────────────────┐
│  ⚙️ Общие настройки                        │
├─────────────────────────────────────────────┤
│                                              │
│  Уведомления                                │
│  [🔔] Включить уведомления о новых          │
│       сообщениях                             │
│                                              │
│  Фильтры чата                               │
│  [✓] MoodBar (скрывать спам и негатив)      │
│  [✓] Показывать только вопросы               │
│                                              │
│  Интерфейс                                  │
│  [Темная] [Светлая] [Авто]                  │
│                                              │
│  Язык                                        │
│  [Русский ▼]                                 │
│                                              │
└─────────────────────────────────────────────┘
```

**Настройки:**

#### 4.1. Уведомления
- Включить/выключить уведомления о новых сообщениях
- Звуковые уведомления
- Desktop-уведомления

#### 4.2. Фильтры чата
- MoodBar (скрывать спам и негативные сообщения)
- Показывать только вопросы
- Показывать все вопросы (из всех стримов)

#### 4.3. Интерфейс
- Тема: Темная / Светлая / Авто (по системным настройкам)
- Размер шрифта: Мелкий / Средний / Крупный
- Компактный режим

#### 4.4. Язык
- Выбор языка интерфейса (Русский, English, Українська)

### 5. Управление стримами

```
┌─────────────────────────────────────────────┐
│  📺 Мои стримы                              │
├─────────────────────────────────────────────┤
│                                              │
│  Активные стримы: 3                         │
│  [Показать все →]                          │
│                                              │
│  История стримов                            │
│  Просмотрено стримов: 45                    │
│  [Показать историю →]                       │
│                                              │
│  [🗑️ Очистить историю]                     │
└─────────────────────────────────────────────┘
```

**Функции:**
- Просмотр активных стримов (ссылка на главную страницу)
- История просмотренных стримов
- Очистка истории

### 6. Статистика (опционально)

```
┌─────────────────────────────────────────────┐
│  📊 Статистика                              │
├─────────────────────────────────────────────┤
│                                              │
│  Всего сообщений просмотрено: 12,450        │
│  Вопросов найдено: 1,234                    │
│  Спам отфильтровано: 567                    │
│                                              │
│  Активность за последние 7 дней:            │
│  [График активности]                        │
└─────────────────────────────────────────────┘
```

**Метрики:**
- Всего сообщений просмотрено
- Вопросов найдено
- Спам отфильтровано
- График активности (опционально)

### 7. API и данные

```
┌─────────────────────────────────────────────┐
│  🔑 API ключи                               │
├─────────────────────────────────────────────┤
│                                              │
│  AI обучений использовано: 1/3 (сегодня)   │
│  Токенов использовано: 45,000              │
│  Примерная стоимость: $0.045                │
│                                              │
│  [📊 Детальная статистика →]                │
└─────────────────────────────────────────────┘
```

**Информация:**
- Использование AI (обучений за день)
- Токены использованы
- Примерная стоимость (если показывать)

## 📱 Responsive дизайн

### Mobile (< 768px)
- Вертикальный скролл по секциям
- Компактные карточки
- Полноэкранные модальные окна для настроек
- Свайп-жесты для навигации

### Tablet (768px - 1024px)
- 2 колонки для настроек
- Боковая панель навигации (опционально)

### Desktop (> 1024px)
- 3 колонки или сайдбар
- Всплывающие панели для детальных настроек
- Hover-эффекты

## 🔄 Поток данных

### Загрузка страницы:
```javascript
1. Проверка авторизации → если нет → редирект на /auth
2. Загрузка профиля пользователя (GET /api/v1/auth/me)
3. Загрузка AI правил (GET /api/v1/ai-filter/rules)
4. Загрузка настроек приложения (из localStorage или БД)
5. Загрузка статистики (опционально)
```

### Сохранение настроек:
```javascript
// Настройки приложения
POST /api/v1/user/settings
{
  notifications: true,
  moodBarEnabled: true,
  theme: "dark",
  language: "ru"
}

// AI правила (через отдельный endpoint)
POST /api/v1/ai-filter/train
```

## 🎨 Компоненты

### UserProfilePage.jsx
```javascript
const UserProfilePage = () => {
  const [user, setUser] = useState(null);
  const [aiRules, setAiRules] = useState(null);
  const [settings, setSettings] = useState({});
  const [isLoading, setIsLoading] = useState(true);
  
  // Загрузка данных
  useEffect(() => {
    loadUserProfile();
    loadAIRules();
    loadSettings();
  }, []);
  
  return (
    <div className="user-profile-page">
      <Header />
      <ProfileSection user={user} />
      <AISettingsSection rules={aiRules} />
      <AppSettingsSection settings={settings} />
      <StreamsSection />
      <StatisticsSection />
    </div>
  );
};
```

### ProfileSection.jsx
- Отображение аватара, имени, email
- Информация о регистрации

### AISettingsSection.jsx
- Статус обучения
- Кнопка обучения / переобучения
- Модальное окно с настройками обучения
- Прогресс обучения

### AppSettingsSection.jsx
- Переключатели уведомлений
- Выбор темы
- Выбор языка
- Настройки фильтров

### StreamsSection.jsx
- Ссылки на активные стримы
- История стримов

### StatisticsSection.jsx
- Метрики использования
- Графики (опционально)

## 🔐 Авторизация

### Проверка доступа:
```javascript
// Middleware на бэкенде
const requireAuth = (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  if (!token) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  // Проверка токена
  const user = verifyToken(token);
  req.user = user;
  next();
};
```

### На фронтенде:
```javascript
// Проверка перед показом страницы
useEffect(() => {
  const token = localStorage.getItem('token');
  if (!token) {
    navigate('/auth');
    return;
  }
  // Загрузка данных профиля
}, []);
```

## 📊 API Endpoints

### GET /api/v1/auth/me
**Получить профиль пользователя**

**Response:**
```json
{
  "id": "user123",
  "email": "user@example.com",
  "name": "User Name",
  "provider": "google",
  "avatar": "https://...",
  "createdAt": "2024-01-15T10:00:00Z"
}
```

### GET /api/v1/user/settings
**Получить настройки пользователя**

**Response:**
```json
{
  "notifications": true,
  "moodBarEnabled": true,
  "theme": "dark",
  "language": "ru",
  "fontSize": "medium",
  "compactMode": false
}
```

### POST /api/v1/user/settings
**Сохранить настройки**

**Request:**
```json
{
  "notifications": true,
  "moodBarEnabled": true,
  "theme": "dark",
  "language": "ru"
}
```

### GET /api/v1/ai-filter/rules
**Получить AI правила** (см. AI_SPAM_FILTER_LOGIC.md)

### POST /api/v1/ai-filter/train
**Обучить AI фильтр** (см. AI_SPAM_FILTER_LOGIC.md)

### POST /api/v1/auth/logout
**Выход из аккаунта**

**Response:**
```json
{
  "success": true,
  "message": "Logged out"
}
```

## 🗄️ Хранение данных

### БД таблицы:

**users** (если нужна более детальная информация)
```sql
CREATE TABLE users (
  id VARCHAR(255) PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255),
  avatar_url TEXT,
  provider VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**user_settings**
```sql
CREATE TABLE user_settings (
  user_id VARCHAR(255) PRIMARY KEY,
  notifications BOOLEAN DEFAULT true,
  mood_bar_enabled BOOLEAN DEFAULT false,
  theme VARCHAR(50) DEFAULT 'dark',
  language VARCHAR(10) DEFAULT 'ru',
  font_size VARCHAR(20) DEFAULT 'medium',
  compact_mode BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**user_spam_rules** (см. AI_SPAM_FILTER_LOGIC.md)

### LocalStorage (для временных настроек):
```javascript
{
  "user_token": "...",
  "theme": "dark",
  "language": "ru"
}
```

## 🎯 Навигация

### Переход на страницу:
1. **Из Header:**
   - Клик на аватар → меню → "Профиль"
   - Или прямая ссылка на иконке настроек

2. **Из меню:**
   - Боковое меню → "Настройки"

3. **Из других страниц:**
   - Ссылка "Настройки" в футере

### Внутренняя навигация:
- Якорные ссылки (#ai-settings, #app-settings)
- Плавная прокрутка к секциям
- Сохранение позиции скролла (опционально)

## ✅ Чеклист реализации

**Backend:**
- [ ] Endpoint `/api/v1/auth/me` (получить профиль)
- [ ] Endpoint `/api/v1/user/settings` (GET/POST)
- [ ] Endpoint `/api/v1/auth/logout`
- [ ] Таблица `user_settings` (миграция)
- [ ] Middleware проверки авторизации
- [ ] Интеграция с Google OAuth

**Frontend:**
- [ ] Компонент `UserProfilePage.jsx`
- [ ] Компонент `ProfileSection.jsx`
- [ ] Компонент `AISettingsSection.jsx`
- [ ] Компонент `AppSettingsSection.jsx`
- [ ] Компонент `StreamsSection.jsx`
- [ ] Компонент `StatisticsSection.jsx` (опционально)
- [ ] Модальное окно `AITrainingModal.jsx`
- [ ] Интеграция с роутингом
- [ ] Проверка авторизации
- [ ] Responsive дизайн

**Стили:**
- [ ] Стили для страницы профиля
- [ ] Компоненты карточек настроек
- [ ] Адаптивность (mobile/tablet/desktop)
- [ ] Анимации переходов

**Тестирование:**
- [ ] Тест загрузки профиля
- [ ] Тест сохранения настроек
- [ ] Тест AI обучения
- [ ] Тест авторизации
- [ ] Тест responsive дизайна

## 🚀 Приоритеты реализации

**Фаза 1 (MVP):**
1. Базовая страница профиля (имя, email, аватар)
2. Блок AI настроек (статус + кнопка обучения)
3. Базовые настройки приложения (тема, язык)

**Фаза 2:**
4. Полная интеграция AI обучения
5. Управление стримами
6. Детальная статистика

**Фаза 3:**
7. Графики активности
8. Расширенные настройки
9. Экспорт данных (опционально)

