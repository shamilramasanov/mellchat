# üìã –ó–∞–¥–∞—á–∏ –ø–æ –∞–¥–º–∏–Ω–∫–µ MellChat

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** üî¥ –í —Ä–∞–±–æ—Ç–µ

---

## 1. üí¨ –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –ø–ª–∞–Ω–∞—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ —á–∞—Ç–µ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

#### 1.1 Broadcast —Å–æ–æ–±—â–µ–Ω–∏—è (–≤—Å–µ–º –≤ —á–∞—Ç–µ)
- ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚è≥ –£–ª—É—á—à–µ–Ω–∏—è:
  - –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  - –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Twitch/YouTube/Kick)
  - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  - –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

#### 1.2 –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –£–ª—É—á—à–µ–Ω–∏—è:
  - –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏
  - –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω)
  - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ/–ø—Ä–æ—á—Ç–µ–Ω–∏–∏
  - –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**Frontend:**
```
frontend/pwa/src/admin/components/Messaging/
‚îú‚îÄ‚îÄ BroadcastPanel.jsx        # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º
‚îú‚îÄ‚îÄ PersonalMessagePanel.jsx   # –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ MessageTemplates.jsx       # –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ MessageHistory.jsx         # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```

**Backend API:**
```javascript
// Broadcast —Å–æ–æ–±—â–µ–Ω–∏—è
POST /api/v1/admin/messages/broadcast
Body: {
  message: string,
  streamId?: string,        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç—Ä–∏–º
  platform?: string,         // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
  includeOffline?: boolean  // –í–∫–ª—é—á–∏—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
}

// –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
POST /api/v1/admin/messages/personal
Body: {
  userId: string,
  username: string,
  message: string,
  streamId?: string
}

// –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
GET /api/v1/admin/messages/history?limit=50&offset=0
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
CREATE TABLE IF NOT EXISTS admin_messages (
    id SERIAL PRIMARY KEY,
    admin_id INTEGER NOT NULL,
    message_type VARCHAR(20) NOT NULL, -- 'broadcast' | 'personal'
    recipient_type VARCHAR(20),        -- 'all' | 'stream' | 'platform' | 'user'
    recipient_id VARCHAR(255),         -- streamId, platform, userId
    message_text TEXT NOT NULL,
    sent_at TIMESTAMP DEFAULT NOW(),
    delivered_at TIMESTAMP,
    read_at TIMESTAMP,
    delivery_status VARCHAR(20) DEFAULT 'pending' -- 'pending' | 'delivered' | 'failed'
);

CREATE INDEX IF NOT EXISTS idx_admin_messages_admin_id ON admin_messages(admin_id);
CREATE INDEX IF NOT EXISTS idx_admin_messages_recipient ON admin_messages(recipient_type, recipient_id);
CREATE INDEX IF NOT EXISTS idx_admin_messages_sent_at ON admin_messages(sent_at);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í—Ä–µ–º—è:** 1-2 –Ω–µ–¥–µ–ª–∏

---

## 2. üë• –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –ø–ª–∞–Ω–∞—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í —Ä–∞–∑–¥–µ–ª–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏, –±–∞–Ω–∞ –∏ —Ä–∞–∑–±–∞–Ω–∞.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

#### 2.1 –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚è≥ –¢–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã
- ‚è≥ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ:
  - –°—Ç–∞—Ç—É—Å (–æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω)
  - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (Twitch/YouTube/Kick)
  - –°—Ç–∞—Ç—É—Å –±–∞–Ω–∞ (–∞–∫—Ç–∏–≤–µ–Ω/–∑–∞–±–∞–Ω–µ–Ω)
  - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª—é–±–æ–π –∫–æ–ª–æ–Ω–∫–µ
- ‚è≥ –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 2.2 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
- ‚è≥ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∏–º–æ–≤
- ‚è≥ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∞
- ‚è≥ –ú–∞—Å—Å–æ–≤–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚è≥ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 2.3 –ë–∞–Ω/—Ä–∞–∑–±–∞–Ω —Å–∏—Å—Ç–µ–º–∞
- ‚è≥ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
- ‚è≥ –í—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ä–æ–∫–∞
- ‚è≥ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–∞–Ω
- ‚è≥ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ –ò—Å—Ç–æ—Ä–∏—è –±–∞–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∏–º–æ–≤ –ø—Ä–∏ –±–∞–Ω–µ
- ‚è≥ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –±–∞–Ω–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 2.4 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- ‚è≥ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤—Å–µ–≥–æ/—Å–ø–∞–º/—Ç–æ–∫—Å–∏—á–Ω—ã—Ö/–≤–æ–ø—Ä–æ—Å–æ–≤)
- ‚è≥ –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≥—Ä–∞—Ñ–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- ‚è≥ –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∏–º–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å–µ—â–∞–ª
- ‚è≥ –†–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**Frontend:**
```
frontend/pwa/src/admin/components/Moderation/
‚îú‚îÄ‚îÄ UsersList.jsx              # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ UserDetails.jsx            # –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ BanUserModal.jsx          # –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –±–∞–Ω–∞
‚îú‚îÄ‚îÄ UserConnections.jsx        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
‚îî‚îÄ‚îÄ UserActivity.jsx           # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**Backend API:**
```javascript
// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
GET /api/v1/admin/users?page=1&limit=50&filter=...&sort=...

// –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId

// –ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/v1/admin/users/:userId/ban
Body: {
  reason: string,
  duration?: number,  // –≤ —á–∞—Å–∞—Ö, –µ—Å–ª–∏ undefined - –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–∞–Ω
  notifyUser?: boolean
}

// –†–∞–∑–±–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/v1/admin/users/:userId/unban
Body: {
  reason?: string
}

// –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∏–º–æ–≤
POST /api/v1/admin/users/:userId/disconnect
Body: {
  notifyUser?: boolean
}

// –û—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∞
POST /api/v1/admin/users/:userId/disconnect-stream
Body: {
  streamId: string,
  platform: string
}

// –ò—Å—Ç–æ—Ä–∏—è –±–∞–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/ban-history

// –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/activity?timeRange=24h

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/stats
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –±–∞–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_bans (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    username VARCHAR(255) NOT NULL,
    platform VARCHAR(50) NOT NULL,
    admin_id INTEGER NOT NULL,
    reason TEXT NOT NULL,
    banned_at TIMESTAMP DEFAULT NOW(),
    expires_at TIMESTAMP,  -- NULL = –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–∞–Ω
    unbanned_at TIMESTAMP,
    unbanned_by INTEGER,
    unbanned_reason TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    notified BOOLEAN DEFAULT FALSE
);

CREATE INDEX IF NOT EXISTS idx_user_bans_user_id ON user_bans(user_id, platform);
CREATE INDEX IF NOT EXISTS idx_user_bans_is_active ON user_bans(is_active);
CREATE INDEX IF NOT EXISTS idx_user_bans_expires_at ON user_bans(expires_at);

-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_connections_history (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    username VARCHAR(255) NOT NULL,
    platform VARCHAR(50) NOT NULL,
    stream_id VARCHAR(255) NOT NULL,
    connected_at TIMESTAMP DEFAULT NOW(),
    disconnected_at TIMESTAMP,
    disconnected_by INTEGER,  -- admin_id –µ—Å–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω
    disconnect_reason TEXT,
    duration_seconds INTEGER
);

CREATE INDEX IF NOT EXISTS idx_user_connections_user_id ON user_connections_history(user_id, platform);
CREATE INDEX IF NOT EXISTS idx_user_connections_stream_id ON user_connections_history(stream_id);
CREATE INDEX IF NOT EXISTS idx_user_connections_connected_at ON user_connections_history(connected_at);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è  
**–í—Ä–µ–º—è:** 2-3 –Ω–µ–¥–µ–ª–∏

---

## 3. üìä –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –ø–ª–∞–Ω–∞—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–∑–¥–µ–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í —Å–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫–∞–∫–∏–µ —Å—Ç—Ä–∏–º—ã –∏ –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ—Å–µ—â–∞–ª–∏.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

#### 3.1 –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
- ‚è≥ –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚è≥ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚è≥ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∏–º–æ–≤ (preview)
- ‚è≥ –ö–ª–∏–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

#### 3.2 –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚è≥ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∏–º–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–µ—â–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚è≥ –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—Ä–∏–º–∞:
  - –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∏–º–∞ –∏ —Å—Ç—Ä–∏–º–µ—Ä–∞
  - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (Twitch/YouTube/Kick)
  - –í—Ä–µ–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –í—Ä–µ–º—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–æ–ø—Ä–æ—Å—ã, —Å–ø–∞–º, –∫–∞—á–µ—Å—Ç–≤–æ)
- ‚è≥ –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É)
- ‚è≥ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ:
  - –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ
  - –î–∞—Ç–µ –ø–æ—Å–µ—â–µ–Ω–∏—è
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å—Ç—Ä–∏–º–∞/—Å—Ç—Ä–∏–º–µ—Ä–∞
- ‚è≥ –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞)

#### 3.3 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚è≥ –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  - –í—Å–µ–≥–æ —Å—Ç—Ä–∏–º–æ–≤ –ø–æ—Å–µ—â–µ–Ω–æ
  - –û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  - –õ—é–±–∏–º–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
  - –õ—é–±–∏–º—ã–π —Å—Ç—Ä–∏–º–µ—Ä
  - –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  - –ü–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≤—Ä–µ–º—è –¥–Ω—è/–Ω–µ–¥–µ–ª–∏)
- ‚è≥ –¢—Ä–µ–Ω–¥—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≥—Ä–∞—Ñ–∏–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥)
- ‚è≥ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**Frontend:**
```
frontend/pwa/src/admin/components/Users/
‚îú‚îÄ‚îÄ UsersActivityList.jsx      # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
‚îú‚îÄ‚îÄ UserActivityDetails.jsx    # –î–µ—Ç–∞–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ StreamVisitsTimeline.jsx   # –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π —Å—Ç—Ä–∏–º–æ–≤
‚îú‚îÄ‚îÄ ActivityStats.jsx          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ ActivityCharts.jsx         # –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```

**Backend API:**
```javascript
// –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
GET /api/v1/admin/users/activity?page=1&limit=50&sort=lastActivity

// –î–µ—Ç–∞–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/activity?timeRange=30d

// –ü–æ—Å–µ—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∏–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/streams?page=1&limit=20&sort=visitedAt&filter=...

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/activity/stats?timeRange=30d

// –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/admin/users/:userId/activity/chart?timeRange=7d&granularity=hour
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π —Å—Ç—Ä–∏–º–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
CREATE TABLE IF NOT EXISTS user_stream_visits (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    username VARCHAR(255) NOT NULL,
    platform VARCHAR(50) NOT NULL,
    stream_id VARCHAR(255) NOT NULL,
    streamer_name VARCHAR(255),
    stream_title TEXT,
    visited_at TIMESTAMP NOT NULL,
    left_at TIMESTAMP,
    duration_seconds INTEGER,
    messages_count INTEGER DEFAULT 0,
    questions_count INTEGER DEFAULT 0,
    spam_count INTEGER DEFAULT 0,
    avg_message_quality FLOAT DEFAULT 0.0
);

CREATE INDEX IF NOT EXISTS idx_user_stream_visits_user_id ON user_stream_visits(user_id, platform);
CREATE INDEX IF NOT EXISTS idx_user_stream_visits_stream_id ON user_stream_visits(stream_id);
CREATE INDEX IF NOT EXISTS idx_user_stream_visits_visited_at ON user_stream_visits(visited_at);
CREATE INDEX IF NOT EXISTS idx_user_stream_visits_platform ON user_stream_visits(platform);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
CREATE MATERIALIZED VIEW IF NOT EXISTS user_activity_summary AS
SELECT 
    user_id,
    username,
    platform,
    COUNT(DISTINCT stream_id) as total_streams_visited,
    SUM(duration_seconds) as total_watch_time_seconds,
    SUM(messages_count) as total_messages,
    SUM(questions_count) as total_questions,
    MAX(visited_at) as last_activity,
    AVG(duration_seconds) as avg_session_duration
FROM user_stream_visits
GROUP BY user_id, username, platform;

CREATE UNIQUE INDEX ON user_activity_summary(user_id, platform);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è  
**–í—Ä–µ–º—è:** 2 –Ω–µ–¥–µ–ª–∏

---

## 4. üóÇÔ∏è –ë–∞–∑–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è AI

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –ø–ª–∞–Ω–∞—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–∏–ø–∞ "–ö–µ–∫", "–ª–æ–ª", "–æ–º–≥" –∏ —Ç.–ø.) –¥–ª—è –æ–±—É—á–µ–Ω–∏—è AI —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π (moodbar). –ü–æ–∑–≤–æ–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–µ —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

#### 4.1 –°–±–æ—Ä –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:
  - –î–ª–∏–Ω–∞ <= 15 —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
  - –ë–µ–∑ –∑–Ω–∞–∫–æ–≤ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - –ß–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
- ‚è≥ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –ü–æ–¥—Å—á–µ—Ç —á–∞—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚è≥ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∫–∞–∫–æ–π —Å—Ç—Ä–∏–º, –≤—Ä–µ–º—è, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —á–∞—Ç–∞)

#### 4.2 –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
- ‚è≥ –†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:
  - –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ (üòä, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏)
  - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ (üò¢, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏)
  - –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ (üòê, –±–µ–∑ –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è)
- ‚è≥ AI-assisted –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Gemini –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–æ–º
  - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚è≥ –ú–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
- ‚è≥ –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–π

#### 4.3 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
- ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å moodbar —Ñ–∏–ª—å—Ç—Ä–æ–º
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞:
  - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ
  - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ
  - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ
  - –°–∫—Ä—ã–≤–∞—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ
- ‚è≥ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚è≥ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞

#### 4.4 –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚è≥ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚è≥ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é
- ‚è≥ –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚è≥ –ú–∞—Å—Å–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚è≥ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚è≥ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º
- ‚è≥ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**Frontend:**
```
frontend/pwa/src/admin/components/Moodbar/
‚îú‚îÄ‚îÄ ShortMessagesList.jsx      # –°–ø–∏—Å–æ–∫ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ MessageClassification.jsx  # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ MoodFilterSettings.jsx     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
‚îú‚îÄ‚îÄ MoodStatistics.jsx          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
‚îî‚îÄ‚îÄ MoodTraining.jsx           # –û–±—É—á–µ–Ω–∏–µ AI –Ω–∞ –¥–∞–Ω–Ω—ã—Ö
```

**Backend API:**
```javascript
// –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
GET /api/v1/admin/moodbar/short-messages?page=1&limit=50&filter=...

// –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
POST /api/v1/admin/moodbar/messages/:messageId/classify
Body: {
  mood: 'positive' | 'negative' | 'neutral',
  confidence?: number,
  notes?: string
}

// –ú–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
POST /api/v1/admin/moodbar/messages/bulk-classify
Body: {
  messageIds: string[],
  mood: 'positive' | 'negative' | 'neutral'
}

// AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É—è Gemini)
POST /api/v1/admin/moodbar/messages/:messageId/ai-classify

// –ú–∞—Å—Å–æ–≤–∞—è AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
POST /api/v1/admin/moodbar/messages/bulk-ai-classify
Body: {
  messageIds: string[]
}

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
GET /api/v1/admin/moodbar/stats?timeRange=30d

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
GET /api/v1/admin/moodbar/filter-settings
POST /api/v1/admin/moodbar/filter-settings
Body: {
  showPositive: boolean,
  showNeutral: boolean,
  showNegative: boolean,
  minConfidence: number
}

// –û–±—É—á–µ–Ω–∏–µ AI –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
POST /api/v1/admin/moodbar/train-ai
Body: {
  sampleSize?: number,
  useExisting?: boolean
}
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
CREATE TABLE IF NOT EXISTS short_messages (
    id SERIAL PRIMARY KEY,
    message_text VARCHAR(50) NOT NULL,
    message_hash VARCHAR(64) NOT NULL,  -- SHA256 –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
    platform VARCHAR(50),
    first_seen_at TIMESTAMP DEFAULT NOW(),
    last_seen_at TIMESTAMP DEFAULT NOW(),
    usage_count INTEGER DEFAULT 1,
    mood_classification VARCHAR(20),  -- 'positive' | 'negative' | 'neutral' | NULL
    classification_confidence FLOAT DEFAULT 0.0,
    classified_by INTEGER,  -- admin_id
    classified_at TIMESTAMP,
    ai_classified BOOLEAN DEFAULT FALSE,
    notes TEXT,
    UNIQUE(message_hash)
);

CREATE INDEX IF NOT EXISTS idx_short_messages_text ON short_messages(message_text);
CREATE INDEX IF NOT EXISTS idx_short_messages_mood ON short_messages(mood_classification);
CREATE INDEX IF NOT EXISTS idx_short_messages_usage ON short_messages(usage_count DESC);
CREATE INDEX IF NOT EXISTS idx_short_messages_last_seen ON short_messages(last_seen_at DESC);

-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
CREATE TABLE IF NOT EXISTS short_message_usage (
    id SERIAL PRIMARY KEY,
    short_message_id INTEGER REFERENCES short_messages(id),
    user_id VARCHAR(255),
    username VARCHAR(255),
    stream_id VARCHAR(255),
    platform VARCHAR(50),
    chat_mood VARCHAR(20),  -- –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —á–∞—Ç–∞ –≤ –º–æ–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    used_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_short_message_usage_message_id ON short_message_usage(short_message_id);
CREATE INDEX IF NOT EXISTS idx_short_message_usage_stream_id ON short_message_usage(stream_id);
CREATE INDEX IF NOT EXISTS idx_short_message_usage_used_at ON short_message_usage(used_at);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
CREATE TABLE IF NOT EXISTS mood_filter_settings (
    id SERIAL PRIMARY KEY,
    show_positive BOOLEAN DEFAULT TRUE,
    show_neutral BOOLEAN DEFAULT TRUE,
    show_negative BOOLEAN DEFAULT TRUE,
    min_confidence FLOAT DEFAULT 0.7,
    max_short_message_length INTEGER DEFAULT 15,
    updated_by INTEGER,
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(id)
);
```

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**
```javascript
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
function isShortMessage(text, maxLength = 15) {
  const cleaned = text.trim();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
  if (cleaned.length > maxLength) return false;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —ç–º–æ–¥–∑–∏ (—ç–º–æ–¥–∑–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ 1 —Å–∏–º–≤–æ–ª, –Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –±–æ–ª—å—à–µ)
  const emojiRegex = /[\u{1F300}-\u{1F9FF}]/gu;
  const emojiCount = (cleaned.match(emojiRegex) || []).length;
  
  // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏ –∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç - —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  if (emojiCount > 0 && cleaned.length <= 10) return true;
  
  // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –±–µ–∑ –∑–Ω–∞–∫–æ–≤ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  // const punctuationRegex = /[.!?;:,]$/;
  // if (punctuationRegex.test(cleaned)) return false;
  
  return true;
}
```

**AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É—è Gemini):**
```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Gemini –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
async function classifyMoodWithAI(messageText) {
  const prompt = `–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞ —Å—Ç—Ä–∏–º–∞ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é:
"${messageText}"

–û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º: positive, negative, –∏–ª–∏ neutral.

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
- –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞ —Å—Ç—Ä–∏–º–∞ (Twitch/YouTube/Kick)
- –£—á–∏—Ç—ã–≤–∞–π –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å–ª–µ–Ω–≥
- –≠–º–æ–¥–∑–∏ –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é —Å–æ–æ–±—â–µ–Ω–∏—è

–ü—Ä–∏–º–µ—Ä—ã:
- "–ª–æ–ª" -> positive
- "–∫–µ–∫" -> positive  
- "–æ–º–≥" -> positive
- "—Ñ—É" -> negative
- "–æ–∫" -> neutral`;

  const result = await geminiService.chat(prompt);
  // –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é
  return parseMoodClassification(result.response);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í—Ä–µ–º—è:** 2-3 –Ω–µ–¥–µ–ª–∏

---

## üìä –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è | –°—Ç–∞—Ç—É—Å |
|--------|-----------|-----------|-------|--------|
| 1. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω—è—è | 1-2 –Ω–µ–¥–µ–ª–∏ | ‚è≥ –í –ø–ª–∞–Ω–∞—Ö |
| 2. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | –í—ã—Å–æ–∫–∞—è | 2-3 –Ω–µ–¥–µ–ª–∏ | ‚è≥ –í –ø–ª–∞–Ω–∞—Ö |
| 3. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è | 2 –Ω–µ–¥–µ–ª–∏ | ‚è≥ –í –ø–ª–∞–Ω–∞—Ö |
| 4. –ë–∞–∑–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω—è—è | 2-3 –Ω–µ–¥–µ–ª–∏ | ‚è≥ –í –ø–ª–∞–Ω–∞—Ö |

---

## üîÑ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

1. **–ó–∞–¥–∞—á–∞ 1** - –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —É–∂–µ –µ—Å—Ç—å)
2. **–ó–∞–¥–∞—á–∞ 3** - –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
3. **–ó–∞–¥–∞—á–∞ 2** - –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
4. **–ó–∞–¥–∞—á–∞ 4** - –ë–∞–∑–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å —É—á—ë—Ç–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∫–æ–¥–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ production –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- –°–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ `.cursorrules`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –î–æ–±–∞–≤–ª—è—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API
- –ü–æ–∫—Ä—ã–≤–∞—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

