# ü§ñ AI Spam Filter - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 1 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è Frontend –≥–æ—Ç–æ–≤ (100%), Backend –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (0%)

---

## üìã –û–±–∑–æ—Ä

AI Spam Filter ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è AI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–ø–∞–º–∞. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö AI-–∑–∞–ø—Ä–æ—Å–æ–≤.

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:**
- AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π **–æ–¥–∏–Ω —Ä–∞–∑** (–ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–ø–∞–º–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞
- –ü—Ä–∞–≤–∏–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–ª–æ–∫–∞–ª—å–Ω–æ** –±–µ–∑ AI-–∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤—Ä—É—á–Ω—É—é

---

## ‚úÖ Frontend (100% –≥–æ—Ç–æ–≤)

### AISettingsSection
**–§–∞–π–ª:** `frontend/pwa/src/features/newui/screens/profile/components/AISettingsSection.jsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
- –ö–Ω–æ–ø–∫–∞ "–û–±—É—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä" / "–ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –æ–±—É—á–µ–Ω)
- –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è

### AITrainingModal
**–§–∞–π–ª:** `frontend/pwa/src/features/newui/screens/profile/components/AITrainingModal.jsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ (5k, 10k, 50k+)
- –í—ã–±–æ—Ä –æ–±–ª–∞—Å—Ç–∏ –≤—ã–±–æ—Ä–∫–∏ (–≤—Å–µ —Å—Ç—Ä–∏–º—ã, –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∏–º—ã)
- –í—ã–±–æ—Ä —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞ (—Å—Ç—Ä–æ–≥–∏–π, —É–º–µ—Ä–µ–Ω–Ω—ã–π, –º—è–≥–∫–∏–π)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è

### API –º–µ—Ç–æ–¥—ã
**–§–∞–π–ª:** `frontend/pwa/src/shared/services/api.js`

```javascript
aiFilterAPI: {
  getRules: () => api.get('/ai-filter/rules'),
  train: (config) => api.post('/ai-filter/train', config),
  deleteRules: () => api.delete('/ai-filter/rules'),
}
```

---

## ‚ùå Backend (0% - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

### –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

1. **Routes:**
   - `backend/api-gateway/src/routes/aiFilter.js` ‚Äî ‚ùå –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

2. **Services:**
   - `backend/api-gateway/src/services/aiFilterService.js` ‚Äî ‚ùå –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

#### Endpoint 1: GET `/api/v1/ai-filter/rules`
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î (`user_spam_rules`)
- –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å: –æ–±—É—á–µ–Ω/–Ω–µ –æ–±—É—á–µ–Ω
- –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å)

**Response:**
```json
{
  "success": true,
  "hasRules": true,
  "rules": {
    "patterns": [...],
    "keywords": {...},
    "thresholds": {...},
    "regexPatterns": [...]
  },
  "stats": {
    "sampleSize": 10000,
    "spamFound": 250,
    "spamRate": 2.5
  },
  "updatedAt": "2025-11-01T12:00:00Z"
}
```

#### Endpoint 2: POST `/api/v1/ai-filter/train`
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±–æ—Ä–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ë–î
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∞–Ω–∞–ª–∏–∑ –≤ Gemini API
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ –ë–î (`user_spam_rules`)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å rate limiting (–º–∞–∫—Å–∏–º—É–º 3 –æ–±—É—á–µ–Ω–∏—è –≤ –¥–µ–Ω—å)

**Request:**
```json
{
  "sampleSize": 10000,
  "scope": "all",
  "trainingMode": "moderate"
}
```

**Response:**
```json
{
  "success": true,
  "rules": {...},
  "stats": {
    "sampleSize": 10000,
    "spamFound": 250,
    "spamRate": 2.5
  },
  "updatedAt": "2025-11-01T12:00:00Z"
}
```

#### Endpoint 3: DELETE `/api/v1/ai-filter/rules`
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞: `user_spam_rules`**
```sql
CREATE TABLE user_spam_rules (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  rules_json JSONB NOT NULL,
  sample_size INTEGER DEFAULT 10000,
  spam_found INTEGER DEFAULT 0,
  spam_detected_rate DECIMAL(5,2) DEFAULT 0.00,
  training_mode VARCHAR(50) DEFAULT 'moderate',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id)
);
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `rules_json`:**
```json
{
  "patterns": [
    "–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–ª–æ–≤–∞ –±–æ–ª–µ–µ 3 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥",
    "—Ç–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ (–±–æ–ª–µ–µ 80% —ç–º–æ–¥–∑–∏)",
    "—Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∞–π—Ç—ã"
  ],
  "keywords": {
    "strict": ["buy", "click here", "free money"],
    "moderate": ["spam", "ad", "promo"],
    "soft": []
  },
  "thresholds": {
    "repetitionScore": 0.4,
    "emojiRatio": 0.6,
    "capsRatio": 0.7,
    "spamWordsRatio": 0.5,
    "messageScoreThreshold": 25
  },
  "regexPatterns": [
    "https?://[^\\s]+",
    "[a-zA-Z]{1}\\1{4,}",
    "^[\\p{Emoji}\\s]+$"
  ]
}
```

### 2. –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ –∏–∑ –ë–î**
   - –ó–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ `messages`
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ scope (all/active/stream_id)
   - –õ–∏–º–∏—Ç –ø–æ sampleSize

2. **–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Gemini API**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å–ø–∞–º–∞
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É `user_spam_rules`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª

–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `messageScoringEngine.js`:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemini API

**–§–∞–π–ª:** `backend/api-gateway/src/services/geminiService.js`

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:
```javascript
async analyzeSpamPatterns(messages, trainingMode) {
  const prompt = `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å—Ç—Ä–∏–º–µ—Ä–∞. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–ø–∞–º–∞.
  
  –°–æ–æ–±—â–µ–Ω–∏—è:
  ${JSON.stringify(messages, null, 2)}
  
  –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è: ${trainingMode}
  - strict: –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä
  - moderate: —É–º–µ—Ä–µ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
  - soft: –º—è–≥–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
  
  –í–µ—Ä–Ω–∏ JSON —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
  {
    "patterns": ["–æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤"],
    "keywords": {"strict": [], "moderate": [], "soft": []},
    "thresholds": {...},
    "regexPatterns": []
  }`;
  
  // –í—ã–∑–æ–≤ Gemini API
  // ...
}
```

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Backend

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Service
- `backend/api-gateway/src/services/aiFilterService.js`
- –ú–µ—Ç–æ–¥—ã: `getRules()`, `train()`, `deleteRules()`

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å Routes
- `backend/api-gateway/src/routes/aiFilter.js`
- Endpoints: GET, POST, DELETE

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ index.js
- –î–æ–±–∞–≤–∏—Ç—å `app.use('/api/v1/ai-filter', aiFilterRoutes)`

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å messageScoringEngine
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ –ë–î
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è > –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

---

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Backend –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** ‚Äî frontend –≥–æ—Ç–æ–≤, –Ω–æ endpoints –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
2. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `user_spam_rules` —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ (‚úÖ –≥–æ—Ç–æ–≤–æ)

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [AI Realtime Filter](./REALTIME_FILTER.md) ‚Äî –æ–±—Å—É–∂–¥–µ–Ω–∏–µ realtime —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- [User Profile Logic](../../../USER_PROFILE_PAGE_LOGIC.md) ‚Äî —Å–µ–∫—Ü–∏—è AI –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω –∏–∑: AI_SPAM_FILTER_LOGIC.md, AI_FILTER_IMPLEMENTATION.md*

